营销类

目录 营销类1.计算某区县网格站或零售户1-7月各卷烟规格销售情况2.计算



1.计算某区县网格站或零售户1-7月各卷烟规格销售情况

2018-7-25 15:19:50

- 计算某零售户1-7月情况
      SELECT A.CUST_ID, A.PRINCIPAL, A.ITEM_NAME
      	, DECODE(QTY1, NULL, 0, QTY1) AS QTY1
      	, DECODE(QTY2, NULL, 0, QTY2) AS QTY2
      	, DECODE(QTY3, NULL, 0, QTY3) AS QTY3
      	, DECODE(QTY4, NULL, 0, QTY4) AS QTY4
      	, DECODE(QTY5, NULL, 0, QTY5) AS QTY5
      	, DECODE(QTY6, NULL, 0, QTY6) AS QTY6
      	, DECODE(QTY7, NULL, 0, QTY7) AS QTY7
      FROM (
      	SELECT CUST_ID, PRINCIPAL, ITEM_NAME, MAX(CASE 
      			WHEN DATE1 = '201801' THEN QTY
      		END) AS QTY1
      		, MAX(CASE 
      			WHEN DATE1 = '201802' THEN QTY
      		END) AS QTY2, MAX(CASE 
      			WHEN DATE1 = '201803' THEN QTY
      		END) AS QTY3
      		, MAX(CASE 
      			WHEN DATE1 = '201804' THEN QTY
      		END) AS QTY4, MAX(CASE 
      			WHEN DATE1 = '201805' THEN QTY
      		END) AS QTY5
      		, MAX(CASE 
      			WHEN DATE1 = '201806' THEN QTY
      		END) AS QTY6, MAX(CASE 
      			WHEN DATE1 = '201807' THEN QTY
      		END) AS QTY7
      	FROM (
      		SELECT DATE1, CUST_ID, ENTERPRISE_NAME, PRINCIPAL, SALE_LEVEL
      			, P_PHONE, SALEDEPT_NAME, ENTERPRISE_ADD, ITEM_NAME
      			, SUM(QTY_SOLD) AS QTY
      		FROM V_PI_CUST_ITEM_MONTH_V6
      		WHERE (DATE1 >= '201801'
      			AND QTY_SOLD > 0
      			AND CUST_ID IN ('360921140777'))
      		GROUP BY CUST_ID, ENTERPRISE_NAME, PRINCIPAL, SALE_LEVEL, P_PHONE, SALEDEPT_NAME, ENTERPRISE_ADD, ITEM_NAME, DATE1
      	)
      	GROUP BY CUST_ID, PRINCIPAL, ITEM_NAME
      ) A
      ORDER BY 1, 3
- 计算某区县(奉新县)网格站1-7月情况
      SELECT A.SALE_DEPT_NAME, A.ITEM_NAME
      	, DECODE(QTY1, NULL, 0, QTY1) AS QTY1
      	, DECODE(QTY2, NULL, 0, QTY2) AS QTY2
      	, DECODE(QTY3, NULL, 0, QTY3) AS QTY3
      	, DECODE(QTY4, NULL, 0, QTY4) AS QTY4
      	, DECODE(QTY5, NULL, 0, QTY5) AS QTY5
      	, DECODE(QTY6, NULL, 0, QTY6) AS QTY6
      	, DECODE(QTY7, NULL, 0, QTY7) AS QTY7
      FROM (
      SELECT SALE_DEPT_NAME, ITEM_NAME, MAX(CASE 
      		WHEN DATE1 = '201801' THEN QTY
      	END) AS QTY1
      	, MAX(CASE 
      		WHEN DATE1 = '201802' THEN QTY
      	END) AS QTY2, MAX(CASE 
      		WHEN DATE1 = '201803' THEN QTY
      	END) AS QTY3
      	, MAX(CASE 
      		WHEN DATE1 = '201804' THEN QTY
      	END) AS QTY4, MAX(CASE 
      		WHEN DATE1 = '201805' THEN QTY
      	END) AS QTY5
      	, MAX(CASE 
      		WHEN DATE1 = '201806' THEN QTY
      	END) AS QTY6, MAX(CASE 
      		WHEN DATE1 = '201807' THEN QTY
      	END) AS QTY7
      FROM (
      	SELECT B.SALE_DEPT_NAME, C.ITEM_NAME, A.*
      	FROM (
      		SELECT SALE_DEPT_ID, ITEM_ID, DATE1
      			, SUM(QTY_SOLD) / 250 AS QTY
      		FROM PI_DEPT_ITEM_MONTH_V6
      		WHERE SALE_CENTER_id = '220000015'
      			AND DATE1 >= '201801'
      		GROUP BY SALE_DEPT_ID, ITEM_ID, DATE1
      	) A
      		LEFT JOIN R_DIM_V6ORGAN B ON A.SALE_DEPT_ID = B.SALE_DEPT_ID
      		LEFT JOIN R_MAIN_TOBACCO_ITEM C ON A.ITEM_ID = C.ITEM_CODE
      )
      GROUP BY SALE_DEPT_NAME, ITEM_NAME
       )A 
       ORDER BY 1,2

2.计算




